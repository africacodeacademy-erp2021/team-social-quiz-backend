version: 2.1

orbs:

  node: circleci/node@4.1


jobs:

  build:
    working_directory: ~/project/backend

    docker:
      - image: cimg/node:15.1
    steps:
      - checkout
      - node/install-packages:
          app-dir: ~/project/backend
          cache-version: v1
          cache-path: node_modules

      - run:
          name: Build app
          command: npm run build  

  test:
    docker:
      - image: cimg/node:15.1

    steps:
     
      - node/install-packages:
          app-dir: ~/project/backend
          cache-version: v1
          cache-path: node_modules

      - run:
          name: Run tests
          command: npm test

  install-packages:
    docker:
      - image: cimg/node:15.1

    steps:
     
      - node/install-packages:
          app-dir: ~/project/backend
          cache-version: v1
          cache-path: node_modules

      - run:
          name: Install dependencies
          command: npm install --save
  
workflows:

  build-test-and-deploy:
   jobs:
    - test 
    - build:
        requires:
         - test
    - install-packages

#express
#chalk
#dotenv
#mongoose
#mongoSanitize

